{"version":3,"sources":["views/MainView/MainView.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["MainView","useState","data","setData","DEFAULT_POSITION","lat","lon","position","setPosition","useEffect","navigator","geolocation","getCurrentPosition","geoposition","coords","latitude","longitude","fetch","method","headers","body","JSON","stringify","then","response","json","inactiveIcon","L","divIcon","className","iconSize","okIcon","level1Icon","level2Icon","level3Icon","level4Icon","getUrl","sensor","source","getLatLng","lng","Map","center","zoom","id","TileLayer","url","attribution","accessToken","Circle","radius","map","s","idx","Marker","key","icon","value","Popup","href","target","rel","App","basename","exact","path","isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","ReactDOM","render","document","getElementById","URL","process","origin","addEventListener","contentType","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.4df9a3bf.chunk.js","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Map, Marker, Popup, TileLayer, Circle } from \"react-leaflet\";\nimport \"./MainView.css\";\nimport \"leaflet/dist/leaflet.css\";\nimport L from \"leaflet\";\n\nexport type Source = \"PWR\" | \"GIOS\" | \"AIRLY\" | \"LOOKO2\";\nexport type Position = {\n  lat: number;\n  lon: number;\n};\n\nexport type Sensor = {\n  lat: number;\n  lon: number;\n  value: number | null;\n  source: Source;\n};\n\nexport function MainView() {\n  const [data, setData] = useState<Array<Sensor>>([]);\n  const DEFAULT_POSITION = { lat: 51.107, lon: 17.0385 };\n  const [position, setPosition] = useState<Position | null>(null);\n\n  useEffect(() => {\n    if (position) return;\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        geoposition => {\n          setPosition({\n            lat: geoposition.coords.latitude,\n            lon: geoposition.coords.longitude\n          });\n        },\n        () => {\n          setPosition(DEFAULT_POSITION);\n        }\n      );\n    } else {\n      setPosition(DEFAULT_POSITION);\n    }\n  }, [position, DEFAULT_POSITION]);\n\n  const RADIUS = 5000;\n\n  useEffect(() => {\n    if (!position) return;\n    fetch(\"https://powietrze.herokuapp.com/api/values\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ position })\n    })\n      .then(response => response.json())\n      .then(response => setData(response));\n  }, [position]);\n\n  const inactiveIcon = L.divIcon({\n    className: \"div-icon inactive\",\n    iconSize: [20, 20]\n  });\n  const okIcon = L.divIcon({ className: \"div-icon ok\", iconSize: [20, 20] });\n  const level1Icon = L.divIcon({\n    className: \"div-icon level-1\",\n    iconSize: [20, 20]\n  });\n  const level2Icon = L.divIcon({\n    className: \"div-icon level-2\",\n    iconSize: [20, 20]\n  });\n  const level3Icon = L.divIcon({\n    className: \"div-icon level-3\",\n    iconSize: [20, 20]\n  });\n  const level4Icon = L.divIcon({\n    className: \"div-icon level-4\",\n    iconSize: [20, 20]\n  });\n\n  function getIcon(sensor: Sensor) {\n    if (sensor.value === null) return inactiveIcon;\n    if (sensor.value < 10) return okIcon;\n    if (sensor.value < 15) return level1Icon;\n    if (sensor.value < 25) return level2Icon;\n    if (sensor.value < 35) return level3Icon;\n    return level4Icon;\n  }\n\n  function getUrl(sensor: Sensor) {\n    switch (sensor.source) {\n      case \"AIRLY\":\n        return \"https://airly.eu/pl/\";\n      case \"GIOS\":\n        return \"https://powietrze.gios.gov.pl/pjp/content/api\";\n      case \"PWR\":\n        return \"http://powietrze.pwr.edu.pl\";\n      case \"LOOKO2\":\n        return \"https://looko2.com\";\n    }\n  }\n  function getLatLng(position: Position): L.LatLngLiteral {\n    return { lat: position.lat, lng: position.lon };\n  }\n\n  return (\n    <Map center={getLatLng(position || DEFAULT_POSITION)} zoom={10} id=\"mapid\">\n      <TileLayer\n        url=\"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}\"\n        attribution='&copy; <a href=\"https://www.mapbox.com/about/maps/\">Mapbox</a> \n                          Â© <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> \n                          <strong><a href=\"https://www.mapbox.com/map-feedback/\" target=\"_blank\" rel=\"noreferer noopener\">\n                          Improve this map</a></strong>'\n        id=\"mapbox.light\"\n        accessToken=\"pk.eyJ1IjoibWthcm9sIiwiYSI6ImNqazl4ODMxMDJ3OTEzd2xlbnN6OHRlMTgifQ.I_mm4Sc8fkKJaFpQc8BWjg\"\n      />\n      {position && (\n        <>\n          <Circle center={getLatLng(position)} radius={RADIUS} />\n          {data.map((s, idx) => (\n            <Marker position={getLatLng(s)} key={idx} icon={getIcon(s)}>\n              {s.value && (\n                <Popup>\n                  {s.value} ug/m3{\" \"}\n                  <a href={getUrl(s)} target=\"_blank\" rel=\"noopener noreferrer\">\n                    {s.source}\n                  </a>\n                </Popup>\n              )}\n            </Marker>\n          ))}\n        </>\n      )}\n    </Map>\n  );\n}\n","import React from \"react\";\nimport \"./App.css\";\nimport { HashRouter, Switch, Route } from \"react-router-dom\";\nimport { MainView } from \"./views/MainView/MainView\";\n\nconst App: React.FC = () => {\n  return (\n    <div className=\"App\">\n      <HashRouter basename=\"/\">\n        <Switch>\n          <Route exact path=\"/\">\n            <MainView />\n          </Route>\n        </Switch>\n      </HashRouter>\n    </div>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}